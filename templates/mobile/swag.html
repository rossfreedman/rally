{% extends "mobile/layout.html" %}
{% set show_back_arrow = True %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    
    <!-- Header -->
    <div class="bg-white border-b border-gray-100">
        <div class="flex items-center px-4 py-6">
            <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center shadow-sm" style="background: linear-gradient(135deg, #c4ff60 0%, #a8e550 100%) !important;">
                <i class="fas fa-shopping-bag text-white text-lg" style="color: #085454 !important;"></i>
            </div>
            <div class="ml-4">
                <h1 class="text-xl font-bold text-gray-900">Rally Merch</h1>
                <p class="text-sm text-gray-500">Get your Rally branded merchandise</p>
            </div>
        </div>
    </div>

    <!-- Products Grid -->
    <div class="px-4 py-6">
        <div class="grid grid-cols-1 gap-4">
            
            <!-- Product 1: Baseball Cap -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden product-card" data-product="Rally Baseball Cap">
                <div class="flex">
                    <div class="w-48 h-48 bg-gray-200 flex items-center justify-center flex-shrink-0 overflow-hidden rounded-l-xl">
                        <img src="{{ url_for('static', filename='images/swag/rally_baseball_hat_black.png') }}" alt="Rally Baseball Cap" class="max-w-full max-h-full object-contain" style="width: 166px; height: 166px;">
                    </div>
                    <div class="flex-1 p-4">
                        <h3 class="font-semibold text-gray-900 mb-1">Rally Baseball Cap</h3>
                        <p class="text-sm text-gray-600 mb-2">Nike Performance Dri-FIT Swoosh breathable adjustable baseball cap with Rally logo embroidered on the front.</p>
                        <div class="flex items-center justify-between">
                            <span class="text-lg font-bold text-teal-600">$20</span>
                            <button onclick="selectProduct('Rally Baseball Cap', '$20')" class="px-4 py-2 rounded-lg text-white font-semibold text-sm transition-all duration-200 hover:shadow-lg" style="background: linear-gradient(135deg, #085454 0%, #10645c 100%);">
                                Select
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product 2: Beanie -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden product-card" data-product="Rally Beanie">
                <div class="flex">
                    <div class="w-48 h-48 bg-gray-200 flex items-center justify-center flex-shrink-0 overflow-hidden rounded-l-xl">
                        <img src="{{ url_for('static', filename='images/swag/rally_beenie_black.png') }}" alt="Rally Beanie" class="max-w-full max-h-full object-contain" style="width: 166px; height: 166px;">
                    </div>
                    <div class="flex-1 p-4">
                        <h3 class="font-semibold text-gray-900 mb-1">Rally Beanie</h3>
                        <p class="text-sm text-gray-600 mb-2">The North Face Circular Rib Rally Beanie - Cozy black beanie with Rally logo. Perfect for staying warm on the courts.</p>
                        <div class="flex items-center justify-between">
                            <span class="text-lg font-bold text-teal-600">$20</span>
                            <button onclick="selectProduct('Rally Beanie', '$20')" class="px-4 py-2 rounded-lg text-white font-semibold text-sm transition-all duration-200 hover:shadow-lg" style="background: linear-gradient(135deg, #085454 0%, #10645c 100%);">
                                Select
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product 3: Winter Hat -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden product-card" data-product="Rally Winter Hat">
                <div class="flex">
                    <div class="w-48 h-48 bg-gray-200 flex items-center justify-center flex-shrink-0 overflow-hidden rounded-l-xl">
                        <img src="{{ url_for('static', filename='images/swag/rally_winter_hat.png') }}" alt="Rally Winter Hat" class="max-w-full max-h-full object-contain" style="width: 166px; height: 166px;">
                    </div>
                    <div class="flex-1 p-4">
                        <h3 class="font-semibold text-gray-900 mb-1">Rally Winter Hat</h3>
                        <p class="text-sm text-gray-600 mb-2">Warm knit beanie with Rally logo patch. Perfect for cold weather games.</p>
                        <div class="flex items-center justify-between">
                            <span class="text-lg font-bold text-teal-600">$20</span>
                            <button onclick="selectProduct('Rally Winter Hat', '$20')" class="px-4 py-2 rounded-lg text-white font-semibold text-sm transition-all duration-200 hover:shadow-lg" style="background: linear-gradient(135deg, #085454 0%, #10645c 100%);">
                                Select
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product 4: T-Shirt -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden product-card" data-product="Rally T-Shirt">
                <div class="flex">
                    <div class="w-48 h-48 bg-gray-200 flex items-center justify-center flex-shrink-0 overflow-hidden rounded-l-xl">
                        <img src="{{ url_for('static', filename='images/swag/rally_tshirt_green.png') }}" alt="Rally T-Shirt" class="max-w-full max-h-full object-contain" style="width: 166px; height: 166px;">
                    </div>
                    <div class="flex-1 p-4">
                        <h3 class="font-semibold text-gray-900 mb-1">Rally T-Shirt</h3>
                        <p class="text-sm text-gray-600 mb-2">Premium cotton t-shirt with Rally logo. Available in multiple sizes.</p>
                        <div class="flex items-center justify-between">
                            <span class="text-lg font-bold text-teal-600">$20</span>
                            <button onclick="selectProduct('Rally T-Shirt', '$20')" class="px-4 py-2 rounded-lg text-white font-semibold text-sm transition-all duration-200 hover:shadow-lg" style="background: linear-gradient(135deg, #085454 0%, #10645c 100%);">
                                Select
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product 5: Water Bottle -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden product-card hidden" data-product="Rally Water Bottle" style="display: none;">
                <div class="flex">
                    <div class="w-48 h-48 bg-gray-200 flex items-center justify-center flex-shrink-0 overflow-hidden rounded-l-xl">
                        <img src="{{ url_for('static', filename='images/swag/rally_waterbottle.png') }}" alt="Rally Water Bottle" class="max-w-full max-h-full object-contain" style="width: 166px; height: 166px;">
                    </div>
                    <div class="flex-1 p-4">
                        <h3 class="font-semibold text-gray-900 mb-1">Rally Water Bottle</h3>
                        <p class="text-sm text-gray-600 mb-2">YETI insulated stainless steel water bottle keeps drinks cold for hours on the court.</p>
                        <div class="flex items-center justify-between">
                            <span class="text-lg font-bold text-teal-600">$30</span>
                            <button onclick="selectProduct('Rally Water Bottle', '$30')" class="px-4 py-2 rounded-lg text-white font-semibold text-sm transition-all duration-200 hover:shadow-lg" style="background: linear-gradient(135deg, #085454 0%, #10645c 100%);">
                                Select
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- Product Selection Modal -->
<div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-xl max-w-md w-full shadow-xl transform transition-all duration-300">
        <div class="p-6">
            <div class="flex items-center mb-4">
                <div class="w-12 h-12 bg-teal-100 rounded-full flex items-center justify-center mr-3">
                    <i class="fas fa-shopping-cart text-teal-600 text-xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">Request: <span id="modalProductName"></span></h3>
                    <p class="text-sm text-gray-600">Price: <span id="modalProductPrice"></span></p>
                </div>
            </div>
            
            <form id="swagForm" onsubmit="sendSwagRequest(event)">
                <!-- Your Name -->
                <div class="mb-4">
                    <label for="userName" class="block text-sm font-medium text-gray-700 mb-2">
                        Your Name <span class="text-red-500">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="userName" 
                        name="userName" 
                        {% if session_data.authenticated %}readonly class="w-full px-4 py-3 border border-gray-300 rounded-xl bg-gray-50 text-gray-600"{% else %}class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-colors"{% endif %}
                        value="{% if session_data.authenticated %}{{ session_data.user.first_name }} {{ session_data.user.last_name }}{% endif %}"
                        {% if not session_data.authenticated %}required{% endif %}
                        placeholder="{% if not session_data.authenticated %}Enter your full name{% endif %}"
                    >
                </div>

                <!-- Phone Number (for unauthenticated users) -->
                {% if not session_data.authenticated %}
                <div class="mb-4">
                    <label for="userPhone" class="block text-sm font-medium text-gray-700 mb-2">
                        Phone Number <span class="text-red-500">*</span>
                    </label>
                    <input 
                        type="tel" 
                        id="userPhone" 
                        name="userPhone" 
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-colors"
                        placeholder="Enter your phone number"
                    >
                </div>
                {% endif %}

                <!-- Additional Notes -->
                <div class="mb-4">
                    <label for="notes" class="block text-sm font-medium text-gray-700 mb-2">
                        Additional Notes (Size, Quantity, etc.)
                    </label>
                    <textarea 
                        id="notes" 
                        name="notes" 
                        rows="3" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-colors resize-none"
                        placeholder="e.g., Size: Large, Quantity: 2, Color preference, etc."
                    ></textarea>
                </div>

                <div class="flex gap-3">
                    <button 
                        type="button"
                        onclick="closeProductModal()"
                        class="flex-1 py-3 px-4 rounded-xl bg-gray-200 text-gray-700 font-semibold transition-all duration-200 hover:bg-gray-300"
                    >
                        Cancel
                    </button>
                    <button 
                        type="submit" 
                        id="sendButton"
                        class="flex-1 py-3 px-4 rounded-xl text-white font-semibold transition-all duration-200 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                        style="background: linear-gradient(135deg, #085454 0%, #10645c 100%);"
                    >
                        Send Request
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-xl max-w-md w-full shadow-xl transform transition-all duration-300">
        <div class="p-6 text-center">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse-slow">
                <i class="fas fa-check text-green-600 text-2xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Request Sent!</h3>
            <p id="successModalMessage" class="text-gray-600 mb-6">We'll reach out shortly to complete your Rally SWAG order!</p>
            <button 
                id="closeSuccessModal" 
                class="w-full py-3 px-4 rounded-xl text-white font-semibold transition-all duration-200"
                style="background: linear-gradient(135deg, #085454 0%, #10645c 100%);">
                <i class="fas fa-thumbs-up mr-2"></i>
                Great!
            </button>
        </div>
    </div>
</div>

<!-- Enhanced Success/Error Messages -->
<div id="messageContainer" class="fixed top-20 left-4 right-4 z-50 hidden transform transition-all duration-300 ease-in-out">
    <div id="messageBox" class="p-4 rounded-xl shadow-lg"></div>
</div>

<script>
let selectedProduct = '';
let selectedPrice = '';

// Select product and show modal
function selectProduct(productName, price) {
    selectedProduct = productName;
    selectedPrice = price;
    
    document.getElementById('modalProductName').textContent = productName;
    document.getElementById('modalProductPrice').textContent = price;
    
    const modal = document.getElementById('productModal');
    modal.classList.remove('hidden');
    
    // Animate modal in
    setTimeout(() => {
        modal.querySelector('.bg-white').style.transform = 'scale(1)';
        modal.querySelector('.bg-white').style.opacity = '1';
    }, 10);
}

// Close product modal
function closeProductModal() {
    const modal = document.getElementById('productModal');
    modal.querySelector('.bg-white').style.transform = 'scale(0.9)';
    modal.querySelector('.bg-white').style.opacity = '0';
    
    setTimeout(() => {
        modal.classList.add('hidden');
        // Reset form
        document.getElementById('swagForm').reset();
        {% if session_data.authenticated %}
        // Reset the name field to the user's name for authenticated users
        document.getElementById('userName').value = '{{ session_data.user.first_name }} {{ session_data.user.last_name }}';
        {% endif %}
    }, 300);
}

// Send swag request
async function sendSwagRequest(event) {
    event.preventDefault();
    
    const form = document.getElementById('swagForm');
    const button = document.getElementById('sendButton');
    const userName = document.getElementById('userName').value.trim();
    const notes = document.getElementById('notes').value.trim();
    
    // Get phone number - from form for unauthenticated users, from session for authenticated users
    let userPhone = '';
    {% if not session_data.authenticated %}
    userPhone = document.getElementById('userPhone').value.trim();
    {% else %}
    // For authenticated users, get phone from session data
    userPhone = '{{ session_data.user.phone_number or "" }}';
    {% endif %}
    
    // Validate form
    if (!userName) {
        showMessage('Please enter your name', 'error');
        return;
    }
    
    {% if not session_data.authenticated %}
    if (!userPhone) {
        showMessage('Please enter your phone number', 'error');
        return;
    }
    {% endif %}
    
    // Show loading state
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Sending...';
    
    try {
        const requestBody = {
            user_name: userName,
            product: selectedProduct,
            price: selectedPrice,
            notes: notes,
            user_phone: userPhone
        };
        
        const response = await fetch('/api/swag-request', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestBody)
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Close product modal
            closeProductModal();
            
            // Show success modal
            showSuccessModal(data.message);
        } else {
            showMessage(data.error || 'Failed to send request', 'error');
        }
        
    } catch (error) {
        console.error('Error sending swag request:', error);
        showMessage('Network error. Please try again.', 'error');
    } finally {
        // Reset button state
        button.disabled = false;
        button.innerHTML = 'Send Request';
    }
}

// Show success/error messages (top notification)
function showMessage(message, type) {
    const container = document.getElementById('messageContainer');
    const messageBox = document.getElementById('messageBox');
    
    const iconClass = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
    const bgColor = type === 'success' ? 'bg-green-100' : 'bg-red-100';
    const textColor = type === 'success' ? 'text-green-800' : 'text-red-800';
    const borderColor = type === 'success' ? 'border-green-200' : 'border-red-200';
    
    messageBox.innerHTML = `
        <div class="flex items-center">
            <i class="${iconClass} mr-3 text-lg"></i>
            <span class="font-medium">${message}</span>
            <button onclick="hideMessage()" class="ml-auto text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
            </button>
        </div>
    `;
    messageBox.className = `p-4 rounded-xl shadow-lg ${bgColor} ${textColor} border ${borderColor}`;
    
    container.classList.remove('hidden');
    container.style.transform = 'translateY(-10px)';
    container.style.opacity = '0';
    
    setTimeout(() => {
        container.style.transform = 'translateY(0)';
        container.style.opacity = '1';
    }, 10);
    
    setTimeout(() => {
        hideMessage();
    }, 4000);
}

// Hide top notification message
function hideMessage() {
    const container = document.getElementById('messageContainer');
    container.style.transform = 'translateY(-10px)';
    container.style.opacity = '0';
    
    setTimeout(() => {
        container.classList.add('hidden');
    }, 300);
}

// Show success modal
function showSuccessModal(message) {
    const modal = document.getElementById('successModal');
    const modalMessage = document.getElementById('successModalMessage');
    
    modalMessage.textContent = message;
    modal.classList.remove('hidden');
    
    setTimeout(() => {
        modal.querySelector('.bg-white').style.transform = 'scale(1)';
        modal.querySelector('.bg-white').style.opacity = '1';
    }, 10);
}

// Close success modal
function closeSuccessModal() {
    const modal = document.getElementById('successModal');
    modal.querySelector('.bg-white').style.transform = 'scale(0.9)';
    modal.querySelector('.bg-white').style.opacity = '0';
    
    setTimeout(() => {
        modal.classList.add('hidden');
    }, 300);
}

// Initialize modals
document.addEventListener('DOMContentLoaded', function() {
    // Close success modal button
    document.getElementById('closeSuccessModal').addEventListener('click', closeSuccessModal);
    
    // Close success modal on backdrop click
    document.getElementById('successModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeSuccessModal();
        }
    });
    
    // Close product modal on backdrop click
    document.getElementById('productModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeProductModal();
        }
    });
    
    // Initialize modal transforms
    const successModal = document.getElementById('successModal');
    const successModalContent = successModal.querySelector('.bg-white');
    successModalContent.style.transform = 'scale(0.9)';
    successModalContent.style.opacity = '0';
    
    const productModal = document.getElementById('productModal');
    const productModalContent = productModal.querySelector('.bg-white');
    productModalContent.style.transform = 'scale(0.9)';
    productModalContent.style.opacity = '0';
});
</script>

<style>
/* Custom styles for modern mobile design */
.min-h-screen {
    min-height: 100vh;
}

/* Product card hover effect */
.product-card {
    transition: transform 0.2s, box-shadow 0.2s;
}

.product-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Shadow utilities */
.shadow-sm {
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
}

.shadow-lg {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

/* Border utilities */
.border-gray-100 { border-color: #f3f4f6; }
.border-gray-300 { border-color: #d1d5db; }
.border-blue-400 { border-color: #60a5fa; }
.border-green-400 { border-color: #4ade80; }
.border-green-200 { border-color: #bbf7d0; }
.border-red-200 { border-color: #fecaca; }

/* Enhanced notification and modal styling */
#messageContainer {
    transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
}

#successModal, #productModal {
    backdrop-filter: blur(4px);
}

#successModal .bg-white, #productModal .bg-white {
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease-in-out;
}

/* Hover effects for buttons */
button:hover {
    transform: translateY(-1px);
}

/* Pulse animation for success icon */
@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}

.animate-pulse-slow {
    animation: pulse 2s ease-in-out infinite;
}

/* Background utilities */
.bg-gray-50 { background-color: #f9fafb; }
.bg-gray-200 { background-color: #e5e7eb; }
.bg-white { background-color: #ffffff; }
.bg-blue-50 { background-color: #eff6ff; }
.bg-green-50 { background-color: #f0fdf4; }
.bg-green-100 { background-color: #dcfce7; }
.bg-red-100 { background-color: #fee2e2; }
.bg-teal-100 { background-color: #ccfbf1; }

/* Text colors */
.text-gray-900 { color: #111827; }
.text-gray-700 { color: #374151; }
.text-gray-600 { color: #4b5563; }
.text-gray-500 { color: #6b7280; }
.text-gray-400 { color: #9ca3af; }
.text-blue-700 { color: #1d4ed8; }
.text-green-600 { color: #16a34a; }
.text-green-700 { color: #15803d; }
.text-green-800 { color: #166534; }
.text-red-500 { color: #ef4444; }
.text-red-800 { color: #991b1b; }
.text-teal-600 { color: #0d9488; }
.text-white { color: #ffffff; }

/* Focus states */
.focus\:ring-2:focus { box-shadow: 0 0 0 2px rgba(20, 184, 166, 0.5); }
.focus\:ring-teal-500:focus { box-shadow: 0 0 0 2px rgba(20, 184, 166, 0.5); }
.focus\:border-teal-500:focus { border-color: #14b8a6; }

/* Border radius utilities */
.rounded-xl { border-radius: 0.75rem; }
.rounded-lg { border-radius: 0.5rem; }
.rounded-full { border-radius: 9999px; }

/* Overflow utilities */
.overflow-hidden { overflow: hidden; }

/* Utility classes */
.flex-shrink-0 { flex-shrink: 0; }
.resize-none { resize: none; }

/* Grid utilities */
.grid {
    display: grid;
}

.grid-cols-1 {
    grid-template-columns: repeat(1, minmax(0, 1fr));
}

.gap-4 {
    gap: 1rem;
}
</style>
{% endblock %}
