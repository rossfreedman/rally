{% extends "mobile/layout.html" %}
{% set show_back_arrow = True %}
{% block title %}User Settings | Rally{% endblock %}
{% block content %}
<div class="min-h-screen bg-gray-50">
    
    <!-- Header -->
    <div class="bg-white border-b border-gray-100">
        <div class="flex items-center px-4 py-6">
            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center shadow-sm">
                <i class="fas fa-user-cog text-white text-lg"></i>
            </div>
            <div class="ml-4">
                <h1 class="text-xl font-bold text-gray-900">User Settings</h1>
                <p class="text-sm text-gray-500">Manage your account preferences</p>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="px-4 py-6 space-y-6">
        
        <!-- Main Settings Form -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            
                        <div class="p-6">
                <form id="user-settings-form" class="space-y-6">
                    
                    <!-- Account Information Section -->
                    <div class="form-section" style="background-color: #f8f9fa; border-radius: 8px; padding: 20px; border-left: 3px solid #007bff;">
                        <h6 class="section-title" style="color: #495057; font-weight: 600; font-size: 0.9rem; margin-bottom: 1rem;">About you</h6>
                        
                        <div class="grid grid-cols-2 gap-4 mb-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" for="firstName">First Name</label>
                                <input type="text" id="firstName" name="firstName" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" for="lastName">Last Name</label>
                                <input type="text" id="lastName" name="lastName" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2" for="email">Email Address</label>
                            <input type="email" id="email" name="email" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2" for="phoneNumber">Phone Number</label>
                            <input type="tel" id="phoneNumber" name="phoneNumber" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="+1 (555) 123-4567">
                            <div class="text-xs text-gray-500 mt-1">For SMS notifications about pickup games, team polls, and lineups</div>
                        </div>

                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2" for="currentPassword">Change Password</label>
                            <input type="password" id="currentPassword" name="currentPassword" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter new password">
                            <div class="text-xs text-gray-500 mt-1">Leave blank to keep current password</div>
                        </div>
                    </div>

                    <!-- Organization Settings Section -->
                    <div class="form-section" style="background-color: #f8f9fa; border-radius: 8px; padding: 20px; border-left: 3px solid #28a745;">
                        <h6 class="section-title" style="color: #495057; font-weight: 600; font-size: 0.9rem; margin-bottom: 1rem;">Where you play</h6>
                        
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2" for="league">League</label>
                            <select id="league" name="league" class="w-full p-3 border border-gray-300 rounded-lg bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required></select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2" for="club">Club</label>
                            <select id="club" name="club" class="w-full p-3 border border-gray-300 rounded-lg bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required></select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2" for="series">Series/Division</label>
                            <select id="series" name="series" class="w-full p-3 border border-gray-300 rounded-lg bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required></select>
                        </div>
                    </div>
                    
                    <!-- Player Preferences Section -->
                    <div class="form-section" id="player-preferences" style="background-color: #f8f9fa; border-radius: 8px; padding: 20px; border-left: 3px solid #ffc107;">
                        <h6 class="section-title" style="color: #495057; font-weight: 600; font-size: 0.9rem; margin-bottom: 1rem;">How you play</h6>
                        
                        <div class="grid grid-cols-2 gap-4 mb-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" for="adDeuce">Ad/Deuce</label>
                                <select id="adDeuce" name="adDeuce" class="w-full p-3 border border-gray-300 rounded-lg bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select preference...</option>
                                    <option value="Ad">Ad</option>
                                    <option value="Deuce">Deuce</option>
                                    <option value="Either">Either</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" for="dominantHand">Dominant Hand</label>
                                <select id="dominantHand" name="dominantHand" class="w-full p-3 border border-gray-300 rounded-lg bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Select hand...</option>
                                    <option value="Righty">Righty</option>
                                    <option value="Lefty">Lefty</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="text-xs text-gray-500">These preferences will be used for match planning and lineups.</div>
                    </div>
                    
                    <div class="pt-4">
                        <button type="submit" class="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors duration-200 font-medium">
                            <i class="fas fa-save mr-2"></i>Save Changes
                        </button>
                    </div>
                </form>
                
                <!-- Success/Error Messages -->
                <div id="settings-success" class="hidden mt-4 bg-green-50 border border-green-100 rounded-lg p-4">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-500 mr-3"></i>
                        <p class="text-green-700 font-medium">Settings updated successfully!</p>
                    </div>
                </div>
                <div id="settings-error" class="hidden mt-4 bg-red-50 border border-red-100 rounded-lg p-4">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                        <p class="text-red-700 font-medium">Error updating settings</p>
                    </div>
                </div>
            </div>
        </div>
        

        
        <!-- Logout Button -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="p-6">
                <a href="/logout" class="w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors duration-200 font-medium flex items-center justify-center">
                    <i class="fas fa-sign-out-alt mr-2"></i>
                    Logout
                </a>
            </div>
        </div>
        
        <!-- Player ID -->
        <div class="text-center py-4">
            <div class="text-xs text-gray-500 font-mono" id="player-id-display">
                Player ID: Loading...
            </div>
        </div>
    </div>
</div>
<script>
// Prefill form with user data
function fillUserSettingsForm(user) {
  document.getElementById('firstName').value = user.first_name || '';
  document.getElementById('lastName').value = user.last_name || '';
  document.getElementById('email').value = user.email || '';
  
  // Strip "+1" from phone number for display, but keep it in database
  let displayPhone = user.phone_number || '';
  if (displayPhone) {
    // Remove +1 prefix and any non-digit characters
    displayPhone = displayPhone.replace(/^\+1/, '').replace(/[^\d]/g, '');
    
    // Format as (XXX) XXX-XXXX if we have 10 digits
    if (displayPhone.length === 10) {
      displayPhone = `(${displayPhone.slice(0,3)}) ${displayPhone.slice(3,6)}-${displayPhone.slice(6)}`;
    }
  }
  document.getElementById('phoneNumber').value = displayPhone;
  
  // Player preferences (placeholders for now)
  document.getElementById('adDeuce').value = user.ad_deuce_preference || '';
  document.getElementById('dominantHand').value = user.dominant_hand || '';
}
// Fetch leagues, clubs and series for dropdowns
function loadLeaguesClubsAndSeries(user) {
  console.log('🔍 Loading leagues, clubs, and series for user:', user);
  
  // Load leagues first
  fetch('/api/get-leagues').then(r=>r.json()).then(data => {
    const leagueSel = document.getElementById('league');
    leagueSel.innerHTML = '<option value="">Select a league...</option>' + 
      data.leagues.map(l => `<option value="${l.league_id}">${l.league_name}</option>`).join('');
    
    // Set user's current league
    if (user.league_id) {
      leagueSel.value = user.league_id;
      console.log('✅ Set league to:', user.league_id);
    }
    
    // Load clubs and series based on selected league (with proper sequencing)
    Promise.all([
      loadClubsByLeague(user.league_id, user.club),
      loadSeriesByLeague(user.league_id, user.series)
    ]).then(() => {
      console.log('✅ All dropdowns loaded successfully');
    }).catch(error => {
      console.error('❌ Error loading dropdowns:', error);
    });
    
    // Add event listener for league changes
    leagueSel.addEventListener('change', function() {
      const selectedLeague = this.value;
      console.log('🔄 League changed to:', selectedLeague);
      
      // Load clubs and series for new league
      loadClubsByLeague(selectedLeague);
      loadSeriesByLeague(selectedLeague);
      
      // Clear club and series selections when league changes
      document.getElementById('club').value = '';
      document.getElementById('series').value = '';
    });
  }).catch(error => {
    console.error('❌ Error loading leagues:', error);
  });
}

// Load clubs filtered by league
function loadClubsByLeague(leagueId, selectedClub = null) {
  const url = leagueId ? `/api/get-clubs-by-league?league_id=${leagueId}` : '/api/get-clubs-by-league';
  
  return fetch(url).then(r=>r.json()).then(data => {
    const clubSel = document.getElementById('club');
    clubSel.innerHTML = '<option value="">Select a club...</option>' + 
      data.clubs.map(c => `<option value="${c}">${c}</option>`).join('');
    
    // Set selected club if provided
    if (selectedClub) {
      clubSel.value = selectedClub;
      console.log('✅ Set club to:', selectedClub);
    }
    
    return data; // Return data for Promise chaining
  }).catch(error => {
    console.error('Error loading clubs:', error);
    // Fallback to all clubs
    return fetch('/api/get-clubs').then(r=>r.json()).then(data => {
      const clubSel = document.getElementById('club');
      clubSel.innerHTML = data.clubs.map(c => `<option value="${c}">${c}</option>`).join('');
      if (selectedClub) {
        clubSel.value = selectedClub;
        console.log('✅ Set club to (fallback):', selectedClub);
      }
      return data;
    });
  });
}

// Helper function to convert Chicago format to Series format (matching backend logic)
function convertChicagoToSeries(seriesName) {
  if (!seriesName) return seriesName;
  
  // Convert "Chicago X" format to "Series X" format for APTA league UI display
  const match = seriesName.match(/^Chicago\s+(\d+)([a-zA-Z\s]*)$/);
  if (match) {
    const number = match[1];
    const suffix = match[2] ? match[2].trim() : '';
    
    if (suffix) {
      return `Series ${number} ${suffix}`;
    } else {
      return `Series ${number}`;
    }
  }
  
  // Return unchanged if not in "Chicago X" format
  return seriesName;
}

// Load series filtered by league
function loadSeriesByLeague(leagueId, selectedSeries = null) {
  console.log('🔍 loadSeriesByLeague called with:', { leagueId, selectedSeries });
  
  // Always start with a clean dropdown
  const seriesSel = document.getElementById('series');
  seriesSel.innerHTML = '<option value="">Select a series...</option>';
  
  // Transform selectedSeries to match API format for APTA leagues
  let transformedSelectedSeries = selectedSeries;
  if (selectedSeries && leagueId && leagueId.startsWith('APTA')) {
    transformedSelectedSeries = convertChicagoToSeries(selectedSeries);
    console.log('🔄 Converted selected series for APTA:', selectedSeries, '->', transformedSelectedSeries);
  }
  
  // IMMEDIATE DISPLAY FIX: If we have the transformedSelectedSeries, populate it immediately
  // This prevents the dropdown from appearing empty during API call
  if (transformedSelectedSeries) {
    const option = document.createElement('option');
    option.value = transformedSelectedSeries;
    option.textContent = transformedSelectedSeries;
    option.selected = true;
    seriesSel.appendChild(option);
    
    console.log('🚀 Series populated immediately from session data:', transformedSelectedSeries);
  }
  
  // Use the new API endpoint that returns user-facing series names from database mappings
  const url = leagueId ? `/api/get-user-facing-series-by-league?league_id=${leagueId}` : '/api/get-user-facing-series-by-league';
  console.log('🔍 Fetching series from URL:', url);
  
  return fetch(url)
    .then(r => r.json())
    .then(data => {
      console.log('🔍 Series API response:', data);
      
      const seriesSel = document.getElementById('series');
      
      if (data.series && Array.isArray(data.series)) {
        console.log('🔍 Processing', data.series.length, 'series options:', data.series);
        
        // Rebuild dropdown with API data
        seriesSel.innerHTML = '<option value="">Select a series...</option>';
        
        // Handle both new object-based format and legacy string format
        data.series.forEach(seriesItem => {
          const option = document.createElement('option');
          
          // Check if we have the new ID-based format with objects
          if (typeof seriesItem === 'object' && seriesItem !== null && seriesItem.id) {
            // NEW: Object-based format with series objects  
            const displayName = seriesItem.display || seriesItem.name || `Series ${seriesItem.id}`;
            
            option.value = JSON.stringify({
              id: seriesItem.id,
              name: seriesItem.name || '',
              display: displayName
            });
            option.textContent = displayName;  // Show user-friendly name
            
            console.log(`  ✅ Object-based series: ${displayName} (ID: ${seriesItem.id})`);
          } else if (typeof seriesItem === 'string') {
            // LEGACY: String format (backward compatibility)
            option.value = seriesItem;
            option.textContent = seriesItem;
            console.log(`  📜 Legacy series: ${seriesItem}`);
          } else {
            // FALLBACK: Handle unexpected format
            console.error('  ❌ Unexpected series format:', seriesItem);
            const fallbackText = String(seriesItem) || 'Unknown Series';
            option.value = fallbackText;
            option.textContent = fallbackText;
          }
          
          seriesSel.appendChild(option);
        });
        
        // Set selected series if provided
        if (selectedSeries) {
          console.log('🔍 Attempting to select series:', transformedSelectedSeries);
          
          // Try direct string match first (for legacy compatibility)
          seriesSel.value = transformedSelectedSeries;
          
          if (seriesSel.value === transformedSelectedSeries) {
            console.log('✅ Series selection confirmed via direct match');
          } else {
            // For object-based format, we need to find the option with matching display name
            let foundMatch = false;
            
            for (let option of seriesSel.options) {
              // Check if option value is JSON (object format)
              try {
                const parsedValue = JSON.parse(option.value);
                if (parsedValue.display === transformedSelectedSeries || parsedValue.name === transformedSelectedSeries) {
                  option.selected = true;
                  foundMatch = true;
                  console.log('✅ Object-based series match found:', parsedValue.display);
                  break;
                }
              } catch (e) {
                // Not JSON, check string value directly
                if (option.value === transformedSelectedSeries || option.textContent === transformedSelectedSeries) {
                  option.selected = true;
                  foundMatch = true;
                  console.log('✅ String-based series match found:', option.value);
                  break;
                }
                
                // CNSWPL FIX: Try partial matching for complex names
                if (option.value.includes(selectedSeries) || option.textContent.includes(selectedSeries)) {
                  option.selected = true;
                  foundMatch = true;
                  console.log('✅ Partial series match found:', option.value);
                  break;
                }
              }
            }
            
            if (!foundMatch) {
              console.log('⚠️  Series selection failed completely');
              console.log('   Original series:', selectedSeries);
              console.log('   Transformed series:', transformedSelectedSeries);
              console.log('   Available options:', Array.from(seriesSel.options).map(opt => opt.textContent).slice(0, 10), '...');
            }
          }
        }
        
        console.log('✅ Series dropdown fully populated from API with', data.series.length, 'options');
      } else {
        console.log('❌ No series data or invalid format:', data);
        // If API fails but we have selectedSeries, ensure it's still shown
        if (selectedSeries && seriesSel.children.length === 1) {
          // Only the default option exists, add the user's series
          const option = document.createElement('option');
          option.value = transformedSelectedSeries;
          option.textContent = transformedSelectedSeries;
          option.selected = true;
          seriesSel.appendChild(option);
          console.log('⚠️  API failed but preserved user series:', transformedSelectedSeries);
        }
      }
      
      return data; // Return data for Promise chaining
    })
    .catch(error => {
      console.error('❌ Error loading series:', error);
      // Fallback to original API if new one fails
      const fallbackUrl = leagueId ? `/api/get-series-by-league?league_id=${leagueId}` : '/api/get-series-by-league';
      console.log('🔄 Trying fallback URL:', fallbackUrl);
      
      return fetch(fallbackUrl)
        .then(r => r.json())
        .then(data => {
          console.log('🔍 Fallback series API response:', data);
          
          const seriesSel = document.getElementById('series');
          seriesSel.innerHTML = '<option value="">Select a series...</option>';
          if (data.series && Array.isArray(data.series)) {
            data.series.forEach(seriesItem => {
              const option = document.createElement('option');
              
              // Handle both object and string formats in fallback
              if (typeof seriesItem === 'object' && seriesItem !== null && seriesItem.id) {
                const displayName = seriesItem.display || seriesItem.name || `Series ${seriesItem.id}`;
                option.value = JSON.stringify({
                  id: seriesItem.id,
                  name: seriesItem.name || '',
                  display: displayName
                });
                option.textContent = displayName;
              } else {
                option.value = seriesItem;
                option.textContent = seriesItem;
              }
              
              seriesSel.appendChild(option);
            });
            if (selectedSeries) {
              // Try to select the series in fallback scenario
              seriesSel.value = transformedSelectedSeries;
              
              if (seriesSel.value !== transformedSelectedSeries) {
                // Try object-based matching for fallback too
                for (let option of seriesSel.options) {
                  try {
                    const parsedValue = JSON.parse(option.value);
                    if (parsedValue.display === transformedSelectedSeries || parsedValue.name === transformedSelectedSeries) {
                      option.selected = true;
                      break;
                    }
                  } catch (e) {
                    // String comparison fallback
                    if (option.textContent === transformedSelectedSeries || option.value.includes(selectedSeries)) {
                      option.selected = true;
                      break;
                    }
                  }
                }
              }
              
              console.log('✅ Set selected series from fallback:', transformedSelectedSeries);
            }
          }
          return data;
        })
        .catch(fallbackError => {
          console.error('❌ Error loading series from fallback:', fallbackError);
                     // Even if fallback fails, ensure user series is preserved
           if (selectedSeries) {
             const seriesSel = document.getElementById('series');
             if (seriesSel.children.length <= 1) {
               const option = document.createElement('option');
               option.value = transformedSelectedSeries;
               option.textContent = transformedSelectedSeries;
               option.selected = true;
               seriesSel.appendChild(option);
               console.log('⚠️  Both APIs failed but preserved user series:', transformedSelectedSeries);
             }
           }
          return { series: [] }; // Return empty data to resolve Promise
        });
    });
}



// On page load, fetch user settings
fetch('/api/get-user-settings').then(r=>r.json()).then(user => {
  console.log('🔍 User settings API response:', user);
  console.log('  - First Name:', user.first_name);
  console.log('  - Last Name:', user.last_name);
  console.log('  - League ID:', user.league_id);
  console.log('  - Club:', user.club);
  console.log('  - Series:', user.series);
  console.log('  - League Context:', user.league_context);
  
  // Fill form first
  fillUserSettingsForm(user);
  
  // Then load dropdowns with proper sequencing
  loadLeaguesClubsAndSeries(user);
  
  // Update Player ID display with user's actual Player ID
  const playerIdDisplay = document.getElementById('player-id-display');
  if (user.tenniscores_player_id) {
    playerIdDisplay.textContent = `Player ID: ${user.tenniscores_player_id}`;
  } else {
    playerIdDisplay.textContent = 'Player ID: Not linked';
  }
}).catch(error => {
  console.error('❌ Error loading user settings:', error);
  // Show error message to user
  const errorDiv = document.getElementById('settings-error');
  if (errorDiv) {
    errorDiv.classList.remove('hidden');
    errorDiv.querySelector('p').textContent = 'Failed to load user settings. Please refresh the page.';
  }
});



// Handle form submit
const form = document.getElementById('user-settings-form');
form.addEventListener('submit', function(e) {
  e.preventDefault();
  
  // Ensure phone number has "+1" prefix for database storage
  let phoneNumber = form.phoneNumber.value.trim();
  if (phoneNumber) {
    // Remove any existing formatting
    phoneNumber = phoneNumber.replace(/[^\d]/g, '');
    
    // Add +1 prefix if not already present
    if (phoneNumber.length === 10) {
      phoneNumber = '+1' + phoneNumber;
    } else if (phoneNumber.length === 11 && phoneNumber.startsWith('1')) {
      phoneNumber = '+' + phoneNumber;
    } else if (!phoneNumber.startsWith('+1')) {
      phoneNumber = '+1' + phoneNumber;
    }
  }
  
  const data = {
    firstName: form.firstName.value,
    lastName: form.lastName.value,
    email: form.email.value,
    phoneNumber: phoneNumber, // Use processed phone number with +1
    league_id: form.league.value,
    club: form.club.value,
    series: form.series.value,
    // Player preferences (placeholders for now)
    adDeuce: form.adDeuce.value,
    dominantHand: form.dominantHand.value,
    currentPassword: form.currentPassword.value // Add current password to data
  };
  
  // Debug logging to help troubleshoot settings vs registration differences
  console.log('🔍 Settings Update Debug - Form Values:');
  console.log('  First Name:', data.firstName);
  console.log('  Last Name:', data.lastName);
  console.log('  League ID:', data.league_id);
  console.log('  Club:', data.club);
  console.log('  Series:', data.series);
  
  // Check what the selected series option actually contains
  const seriesSelect = document.getElementById('series');
  const selectedOption = seriesSelect.options[seriesSelect.selectedIndex];
  console.log('  Series Display Text:', selectedOption?.textContent);
  console.log('  Series Value (submitted):', selectedOption?.value);
  
  fetch('/api/update-settings', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(r => r.json())
  .then(resp => {
    // Debug logging for the API response
    console.log('🔍 Settings Update API Response:');
    console.log('  Response:', resp);
    
    if (resp.success) {
      console.log('✅ Settings update successful');
      window.app && window.app.showToast && window.app.showToast('Settings updated!', 'success');
      
      // Reload page after a short delay to ensure all components are updated
      setTimeout(() => window.location.reload(), 1000);
    } else {
      console.log('❌ Settings update failed:', resp.message);
      window.app && window.app.showToast && window.app.showToast(resp.message || 'Update failed', 'error');
    }
  })
  .catch(() => {
    window.app && window.app.showToast && window.app.showToast('Update failed', 'error');
  });
});
</script>

<script>
// Handle auto-scroll to anchor on page load
document.addEventListener('DOMContentLoaded', function() {
  // Check if there's a hash in the URL
  if (window.location.hash === '#player-preferences') {
    // Wait a short moment for the page to fully render
    setTimeout(() => {
      const element = document.getElementById('player-preferences');
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
        // Add a subtle highlight effect
        element.style.backgroundColor = '#FEF3C7';
        setTimeout(() => {
          element.style.backgroundColor = '';
        }, 2000);
      }
    }, 500);
  }
});
</script>

<style>
/* Custom styles for modern mobile design */
.min-h-screen {
    min-height: 100vh;
}

/* Grid responsive */
@media (max-width: 640px) {
    .grid-cols-2 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
    }
    
    .form-section {
        padding: 16px !important;
        margin-bottom: 1rem;
    }
    
    .section-title {
        font-size: 0.85rem !important;
    }
}

/* Shadow utilities */
.shadow-sm {
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
}

/* Border utilities */
.border-gray-50 { border-color: #f9fafb; }
.border-gray-100 { border-color: #f3f4f6; }
.border-gray-300 { border-color: #d1d5db; }
.border-green-100 { border-color: #dcfce7; }
.border-red-100 { border-color: #fee2e2; }

/* Background utilities */
.bg-gray-50 { background-color: #f9fafb; }
.bg-gray-100 { background-color: #f3f4f6; }
.bg-white { background-color: #ffffff; }
.bg-green-50 { background-color: #f0fdf4; }
.bg-green-600 { background-color: #16a34a; }
.bg-red-50 { background-color: #fef2f2; }

/* Text colors */
.text-gray-900 { color: #111827; }
.text-gray-700 { color: #374151; }
.text-gray-600 { color: #4b5563; }
.text-gray-500 { color: #6b7280; }
.text-gray-400 { color: #9ca3af; }
.text-blue-500 { color: #3b82f6; }
.text-blue-600 { color: #2563eb; }
.text-green-500 { color: #10b981; }
.text-green-600 { color: #059669; }
.text-green-700 { color: #047857; }
.text-purple-500 { color: #8b5cf6; }
.text-red-500 { color: #ef4444; }
.text-red-700 { color: #b91c1c; }
.text-white { color: #ffffff; }

/* Hover colors */
.hover\:bg-green-700:hover { background-color: #15803d; }
.hover\:bg-gray-200:hover { background-color: #e5e7eb; }
.hover\:text-gray-700:hover { color: #374151; }

/* Focus colors */
.focus\:border-blue-500:focus { border-color: #3b82f6; }
.focus\:ring-blue-500:focus { --tw-ring-color: #3b82f6; }
.focus\:ring-green-500:focus { --tw-ring-color: #10b981; }
.focus\:ring-gray-500:focus { --tw-ring-color: #6b7280; }

/* Ring utilities */
.focus\:ring-2:focus {
    --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
    --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
    box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
}

/* Gradient backgrounds */
.bg-gradient-to-br {
    background-image: linear-gradient(to bottom right, var(--tw-gradient-stops));
}
.from-blue-500 {
    --tw-gradient-from: #3b82f6;
    --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(59, 130, 246, 0));
}
.to-blue-600 {
    --tw-gradient-to: #2563eb;
}

/* Spacing utilities */
.space-y-6 > * + * { margin-top: 1.5rem; }
.space-y-4 > * + * { margin-top: 1rem; }

/* Form sections (matching registration page style) */
.form-section {
    margin-bottom: 1.5rem;
}

.section-title {
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Border radius utilities */
.rounded-xl { border-radius: 0.75rem; }
.rounded-lg { border-radius: 0.5rem; }
.rounded-full { border-radius: 9999px; }

/* Overflow utilities */
.overflow-hidden { overflow: hidden; }

/* Transform utilities */
.transform { transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }
.-translate-y-1\/2 { --tw-translate-y: -50%; }

/* Transition utilities */
.transition-colors {
    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
}

.duration-200 {
    transition-duration: 200ms;
}

/* Utility classes */
.hidden { display: none; }
.grid { display: grid; }
.flex { display: flex; }
.items-center { align-items: center; }
.gap-4 { gap: 1rem; }
.font-medium { font-weight: 500; }
.font-semibold { font-weight: 600; }
.font-mono { font-family: ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace; }

/* Responsive design */
@media (max-width: 640px) {
    .px-6 { padding-left: 1rem; padding-right: 1rem; }
    .py-4 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
    .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
    .gap-4 { gap: 0.75rem; }
}
</style>
{% endblock %} 