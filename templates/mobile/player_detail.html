{% extends "mobile/layout.html" %}

{% block content %}
<div class="flex items-center mb-4">
    <a href="/mobile/rankings" class="btn btn-circle btn-ghost mr-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
    </a>
    <div class="flex items-center gap-3">
      <div class="bg-white rounded-md flex items-center justify-center h-12 w-12">
        <i class="fas fa-user text-green-700 text-3xl"></i>
      </div>
      <div>
        <div class="text-2xl font-bold leading-tight">Player Details</div>
        <div class="text-base text-gray-500 mt-1">{{ player_name }}</div>
      </div>
    </div>
</div>

{% if analyze_data.error %}
    <div class="text-red-600 text-center my-8">{{ analyze_data.error }}</div>
{% endif %}

<div class="card bg-base-100 shadow-xl mb-6">
    <div class="card-body">
        <h2 class="card-title text-xl font-bold">Player Stats</h2>
        <div class="stats stats-vertical lg:stats-horizontal shadow mt-4 w-full">
            <div class="stat">
                <div class="stat-title">Current Season Matches</div>
                <div class="stat-value text-primary">{{ analyze_data.current_season.matches }}</div>
            </div>
            <div class="stat">
                <div class="stat-title">Current Season Win Rate</div>
                <div class="stat-value text-accent">{{ analyze_data.current_season.winRate }}%</div>
            </div>
            <div class="stat">
                <div class="stat-title">Career Matches</div>
                <div class="stat-value">{{ analyze_data.career_stats.matches }}</div>
            </div>
            <div class="stat">
                <div class="stat-title">Career Win Rate</div>
                <div class="stat-value">{{ analyze_data.career_stats.winRate }}%</div>
            </div>
            <div class="stat">
                <div class="stat-title">Career PTI</div>
                <div class="stat-value">{{ analyze_data.career_stats.pti }}</div>
            </div>
        </div>
    </div>
</div>

<div class="card bg-base-100 shadow-xl mb-6">
    <div class="card-body">
        <h3 class="card-title text-lg">Court Analysis</h3>
        <div class="overflow-x-auto">
            <table class="table w-full">
                <thead>
                    <tr>
                        <th>Court</th>
                        <th class="text-center">Win Rate</th>
                        <th class="text-center">Record</th>
                        <th class="text-center">Top Partners</th>
                    </tr>
                </thead>
                <tbody>
                    {% for court, stats in analyze_data.court_analysis.items() %}
                        <tr>
                            <td>{{ court|capitalize }}</td>
                            <td class="text-center">{{ stats.winRate }}%</td>
                            <td class="text-center">{{ stats.record }}</td>
                            <td class="text-center">
                                {% if stats.topPartners %}
                                    <ul>
                                    {% for p in stats.topPartners %}
                                        <li>
                                            <a href="/mobile/player-detail/{{ p.name | urlencode }}" class="text-primary hover:underline">{{ p.name }}</a>
                                            <span class="ml-1 text-xs text-gray-500">{{ p.record }}</span>
                                        </li>
                                    {% endfor %}
                                    </ul>
                                {% else %}
                                    <span class="text-gray-400">None</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="card bg-base-100 shadow-xl mb-6">
    <div class="card-body">
        <h3 class="card-title text-lg">Player History (Previous Seasons)</h3>
        {% if analyze_data.player_history.seasons %}
            <div class="overflow-x-auto">
                <table class="table w-full">
                    <thead>
                        <tr>
                            <th>Season</th>
                            <th>Series</th>
                            <th>PTI Start</th>
                            <th>PTI End</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in analyze_data.player_history.seasons %}
                            <tr>
                                <td>{{ row.season }}</td>
                                <td>{{ row.series }}</td>
                                <td>{{ row.ptiStart }}</td>
                                <td>{{ row.ptiEnd }}</td>
                                <td>{{ row.trend }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="text-gray-400 p-2">No season history available.</div>
        {% endif %}
    </div>
</div>

<div class="card bg-base-100 shadow-xl mb-6">
    <div class="card-body">
        <h3 class="card-title text-lg">Review Video Footage</h3>
        <div class="mb-2 font-semibold">Match Videos</div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
            {% set match_videos = analyze_data.videos.match if analyze_data.videos.match else [] %}
            {% for video in match_videos %}
                <div class="video-card">
                    <div class="rounded-lg overflow-hidden relative mb-2">
                        <img src="{{ video.thumbnail or '/static/images/video_thumbnail.png' }}" class="w-full h-36 object-cover" alt="{{ video.title }}">
                        <div class="absolute bottom-2 right-2 bg-black bg-opacity-80 text-white text-xs px-2 py-0.5 rounded">{{ video.duration }}</div>
                    </div>
                    <div class="font-semibold text-xs mb-1">{{ video.title }}</div>
                    <div class="text-xs text-gray-500">{{ video.date }} • {{ video.views }} views</div>
                </div>
            {% endfor %}
        </div>
        <div class="mb-2 font-semibold">Practice Videos</div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {% set practice_videos = analyze_data.videos.practice if analyze_data.videos.practice else [] %}
            {% for video in practice_videos %}
                <div class="video-card">
                    <div class="rounded-lg overflow-hidden relative mb-2">
                        <img src="{{ video.thumbnail or '/static/images/video_thumbnail.png' }}" class="w-full h-36 object-cover" alt="{{ video.title }}">
                        <div class="absolute bottom-2 right-2 bg-black bg-opacity-80 text-white text-xs px-2 py-0.5 rounded">{{ video.duration }}</div>
                    </div>
                    <div class="font-semibold text-xs mb-1">{{ video.title }}</div>
                    <div class="text-xs text-gray-500">{{ video.date }} • {{ video.views }} views</div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}